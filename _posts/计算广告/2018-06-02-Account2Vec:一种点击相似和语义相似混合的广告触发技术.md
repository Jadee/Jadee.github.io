---
title: Account2Vec:一种点击相似和语义相似混合的广告触发技术
date: 2018-06-02
categories: 计算广告
tags:
- 计算广告
- 广告触发
---

#背景

信息流广告的触发和搜索广告不同，请求场景都没有明确的query意图。对于广告系统而言，可以拿到的只有用户画像数据，这点场景和推荐比较相似。因此，这里将推荐场景下比较常见的i2i（item2item）方式进行改进，再结合embedding技术，提出了一种点击相似和语义相似混合的广告触发技术（以下用account2vec代替）。

<!-- more -->

# 现状分析

i2i关系的挖掘是这类触发方法的关键。如何寻找这种关系，通常有两种办法，一种是协同过滤思想，通过点击item的用户群体的重叠程度发现item之间的相似性，这种办法对于信息流广告背后庞大的用户群体而言，计算量和计算精度都是个很麻烦的事情。还有一种办法是从item内容出发，也就是content-based，通过分析item叙述主题和内容的相似性入手，但此类方法缺乏对应用场景的理解，也同样存在自然语言理解上面的局限性。对于寥寥数十个字的广告标题，用传统文本分析方法比较困难。

为此，我们借鉴word2vec的思想，从embedding的角度解决这类问题。既考虑到自然用户在广告应用场景背后的协同思想，也从内容出发，一定程度上缓解了短文本分析的弱点。

# 点击相似

word2vec在自然语言处理和文本分析中应用很广。通常人们会根据海量的自然语料，对word进行向量化构造来表征词之间的关系。这里引入word2vec对序列化建模的优点，对广告ad进行建模。

要想得到广告ad的向量化表示，首先需要构造序列化语料。这里我们收集海量用户在广告系统的线上点击日志，获取点击序列。构造训练网络如下所示：

损失函数和word2vec模型相同

$$ \frac{1}{T} \sum_{t=1}^T \: \: \sum_{-c \leq j \leq c, j \neq 0} \: \: log p(w_{t+j} | w_t) $$

$$ p(w_O|w_I) = \frac{exp(v_{w_o}^{'})}{}$$

采用skip-gram训练方法可以得到每个广告的向量化表示。对于相似广告的距离计算和word2vec相同，采用cosine衡量距离。

# 语义相似

广告在展示时主要以标题和图片两个部分呈现给用户。因此广告语义的涵义范畴应该包括：图片语义特征和文本语义特征两类。对于图片的语义分析，这里暂不考虑，主要分析文本语义，也就是广告标题。

广告标题都是短文本形式，一两行的长度。文本分析的传统办法：文本分类、关键词提取、lda topic主题分析等在短文本上都有一定的困难。这里引入paragraph2vec的办法，直接对ad title进行建模，让其与ad word一道训练向量化表示。具体网络结构如下：

图中input为ad title id，output是构成该ad title的word。损失函数和点击相似模型相同。最后可以得到每个ad title的embedding表示。广告的距离同样用cosine衡量。

值得一提的是，由于短文本行为随意性比较强，通用的切词工具在这类语境的切词效果并不理想，且不论每天都有未登录词不断涌现。为了规避未登录词、切词错误等问题，这里绕过切词流程，直接将标题按字切分后拼成bigram作为word使用，这种办法使得模型对新词的泛化能力更强，同时也规避了因为切词错误带来的转义问题。

# 混合策略

对于一个广告我们可以得到两个向量表示，一个是点击相似，一个是语义相似。最终的相似度量，我们采用一种基于广告频次反馈的混合策略。我们认为，与用户交互程度越深的广告（即热门点击广告），其点击相似值更可信。对于冷门广告和新广告，因为缺乏大量用户点击行为的验证，其语义相似值更可信。

公式中的tf是ad在点击日志中出现的次数。

# 应用落地

前面详细介绍了i2i关系的挖掘流程，这里简单介绍下该触发策略的整体落地方案。

离线部分，负责从海量日志中抽取用户点击序列和广告库行文语料，离线train上述两个model，最终用得到的向量进行混合，生成i2i触发词典。离线train model部分，solver采用无锁sgd，碰撞可以忽略，blas库加速。sim相似度的计算部分，主要计算量在向量归一化后的矩阵点乘操作，这里直接使用eigen进行加速。

在线部分，对于每一个请求以及用户的不同，分别得到用户历史点击和用户历史预估高Q广告，对于这批触发来源分别调用i2i词典进行扩展触发。

离线挖掘部分与在线触发部分的完全隔离，使得对线上架构的改动几乎为0，线上计算量几乎为0。部署简单、易维护也是该落地方案的亮点。

以下是落地方案的大致图示：


# 总结和展望

近期，无论在工业界还是学术界，通过对item和user的向量化表示一个比较热门的方向。通常的方向包括cf-based（如cdae、bpr-mf），content-based（如word2vec、doc2vec），hybrid，model-based（如dnn、dssm）等等。account2vec尽可能的结合content和session信息，无论在思想还是应用上都简易可行，且达到较为理想的效果。但是，本方法毕竟属于生成模型，也不直接针对点击行为进行建模，因此整体精度仍有待提高。

另外，i2i触发方式本身也有其局限性，i2i的触发并没有从全局角度考虑，只是点对点的针对触发的来源进行扩展，并没有通盘考虑用户、场景、item三者的全部信息。i2i方式在整体触发精度上必然弱于u2i方式，因此对点击行为直接进行u2i建模是一种更为合理的优化方向
