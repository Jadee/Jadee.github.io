---
title: 机制设计理论及其在广告竞价中的应用术
date: 2019-05-01
categories: 计算广告
tags:
- 计算广告
- 机制设计
---

本文主要介绍机制设计的起源和基础理论框架，涉及博弈论基础（囚徒困境、纳什均衡、帕累托最优），广告中常用竞价机制GSP、VCG，并力图通过实际的案例、实验等，来帮助读者理解复杂的公式推导和晦涩的基础概念。

希望通过本文，你可以对机制的理论框架、博弈论、GSP、VCG理论等有更好地理解，探索机制设计在更多场景的应用，一起交流和学习。

# 1. 机制设计理论
## 1.1 起源
机制设计是微观经济学和博弈论的一个子领域，考虑如何解决涉及多个自利的、对其偏好拥有私人信息的参与人的问题。<br>
 * 机制设计的目标由一个社会选择函数定义，给定参与人的类型，该函数选择最优的结果。<br>
 * 机制设计问题是试图实施一个博弈规则，以实现社会选择函数的解，而不管参与人的自私倾向。<br>

“机制设计理论”最早由Leonid Hurwicz提出，Eric Maskin 和 Roger B. Myerson 则进一步发展了这一理论。这一理论有助于经济学家、各国政府和企业识别在何种情况下市场机制有效，何种情况市场机制无效，帮助人们确定有效的贸易机制、政策手段和决策过程。三人也因此而获得2007年的诺贝尔经济学奖。

![avatar](/images/计算广告/ad-1.png)

* Leonid Hurwicz <br>
  * 1917年出生于俄罗斯莫斯科，后加入美国国籍；史上年纪最大的诺贝尔奖得主（90岁）；<br>
  * 1973年，Leonid Hurwicz在经济学的顶级期刊《American Economic Review》发表了题为The Design of Mechanisms for Resource Allocation的论文，奠定了机制设计理论的框架，被誉为“机制设计理论之父”。
 
* Eric Maskin <br>
  - 1950年生于美国纽约，获哈佛大学应用数学博士学位，哈佛和MIT的经济学教授<br>
  - 最突出的贡献是将博弈论引入机制设计。在他之前，Hurwicz等学者的机制设计是从中央计划者的角度考虑问题。而Maskin认为并不需要一个“中央计划者”来命令人们应该怎么去做，而是设计一个好的机制，通过机制的引导进行。
 
* Roger B. Myerson <br>
  - 1951年生于美国波士顿，芝加哥大学教授；<br>
  - 1981年在期刊《Mathematics of operations research》上发表的论文Optimal Auction Design，提出了一种可以实现收益最大化的直接机制——Myerson机制，以及构建Myerson机制的方法。

## 1.2 理论框架
### 1.2.1 直接机制 （Direct Mechanism）

![avatar](/images/计算广告/ad-2.png)

一个出售商品的机制可以表示成三元组（B, A, P)，B为报价空间，A为分配规则，P为支付规则。

直接机制：每个竞拍者直接上报自己的真实估值，即报价空间与估价空间一致。

### 1.2.2 显示原理（Revelation Principle）
Roger B. Myerson 1981年在期刊《Mathematics of operations research》上发表的论文“Optimal Auction Design”中对Revelation Principle给出了定义：

Given any feasible auction mechanism, there exists an equivalent feasible direct revelation mechanism which gives to the seller and all bidders the same expected utilities as in the given mechanism.

给定任一可行的机制，以及这个可行机制的某一均衡。则存在某一个可行的直接机制，其中每个买家都真实地披露自己的价值。

 * 我们可以用显示原理来简化对复杂的间接机制的分析，我们只需分析直接机制就可以了。对于直接机制不存在的特性、不能实现的均衡，其相应的间接机制也必然不存在这种特性、不能实现的均衡。<br>
 * 对应机制设计的目标：通过机制的设计，在激励相容的约束条件下，使博弈参与人主动披露自己的信息，以达到消除信息不对称的效果。

### 1.2.3 激励相容（Incentive Compatability）
A mechanism is called incentive-compatible (IC) if every participant can achieve the best outcome to him/herself just by acting according to his/her true preferences.

（来源于维基百科的定义： https://en.wikipedia.org/wiki/Incentive_compatibility ）

对于一个机制，如果所有的买家都可以通过如实地报价（“讲真话”）而达到最大的收益，那么称该机制是激励相容的。

 * 讲真话是利益相关者在这个机制下的最优选择；
 * 这种机制鼓励买家报出自己的真实估价（出价=估价），因为此策略对买家来说是弱占优策略。也就是说所有买家出价等于估价时，此机制能达到一个均衡态（谁也没有动力去主动改变）。
 
## 1.3 机制设计的博弈论基础
### 1.3.1 囚徒困境（Prisoner's Dilemma）
囚徒困境是博弈论的非零和博弈中具代表性的例子。两个嫌疑犯作案后被警察抓住，分别关在不同的屋子里接受审讯。警察知道两人有罪，但缺乏足够的证据。警察告诉每个人：如果两人都抵赖，各判刑半年；如果两人都坦白，各服刑2年；如果两人中一个坦白而另一个抵赖，坦白的放出去，抵赖的服刑10年。于是，每个囚徒都面临两种选择：坦白或抵赖。然而，不管同伙选择什么，每个囚徒的最优选择是坦白。

|  | 甲沉默（合作） | 甲背叛（认罪） |
| :-----| ----: | :----: |
| 乙沉默（合作） | 二人同服刑半年 | 甲即时获释；乙服刑10年 |
| 乙背叛（认罪） | 甲服刑10年；乙即时获释 | 二人同服刑2年 |

囚徒困境的主旨为，囚徒们彼此合作，坚不吐实，可为全体带来最佳利益（服刑半年），但在无法沟通的情况下，因为出卖同伙可为自己带来利益（即时获释），也因为同伙把自己招出来可为他带来利益，因此彼此出卖虽违反最佳共同利益，反而是自己最大利益所在。

### 1.3.2 纳什均衡（Nash Equilibrium)
纳什均衡：无一参与者可以独自行动而增加收益（即为了自身利益的最大化，没有任何单独的一方愿意改变其策略的 ），则此策略组合被称为纳什均衡。

在纳什均衡提出之前，有两个比较著名的观点：

 * 三个火枪手中：All for one, one for all (人人为我，我为人人)，即贵族武士之间，通过自利和利他的行为实现共同目的；<br>
 * 亚当斯密提出invisible hand理论的基本前提：当市场中每个人都进行自利行为的时候，在客观上说，市场（或社会）整体的福利会被提升。<br>
 * 而纳什均衡恰好否定了以上的两个观点。当市场中每个人都进行自利行为的时候，在客观上说，市场（或社会）整体的福利是无法达到最优的。

在“囚徒困境”问题中，两个囚犯符合自己利益的选择是坦白招供，原本对双方都有利的策略不招供从而均被判刑半年就不会出现。事实上，这样两人都选择坦白的策略以及因此被判两年的结局就是纳什均衡。

### 1.3.3 帕累托最优（Pareto Optimality）
帕累托最优是资源分配的一种理想状态。

 * 帕累托改善：给定固有的一群人和可分配的资源，如果从一种分配状态到另一种状态的变化中，在没有使任何人境况变坏的前提下，使得至少一个人变得更好，这就是帕雷托改善。<br>
 * 帕累托最优：帕雷托最优的状态就是不可能再有更多的帕雷托改善的状态，即不可能再改善某些人的境况，而不使任何其他人受损。<br>
对于“囚徒困境问题”，如果博弈是重复发生的，即不断的重复给两个囚徒选择。博弈反复进行，囚徒可以惩罚上一轮对方的不合作的行为，从而使博弈导向较好的、合作的结果。反复进行无数的数量，纳什均衡趋向于帕累托最优。

帕雷托最优只是各种理想态标准中的“最低标准”。

 * 一种状态如果尚未达到帕雷托最优，那么它一定是不理想的，因为还存在改进的余地，可以在不损害任何人的前提下使某一些人的福利得到提高。<br>
 * 但是一种达到了帕雷托最优的状态并不一定真的很“理想”。
 
 举个例子，假设一个社会里只有一个百万富翁和一个快饿死的乞丐，如果这个百万富翁拿出自己财富的万分之一，就可以使后者免于死亡。但是因为这样无偿的财富转移损害了富翁的福利（假设这个乞丐没有什么可以用于回报富翁的资源或服务），所以进行这种财富转移并不是帕雷托改善，而这个只有一个百万富翁和一个饿死乞丐的社会可以被认为是帕雷托最优的。

与古典功利主义（Utilitarianism）的标准做一比较。按功利主义的标准，理想的状态是使人们的福利的总和最大化的状态。如果一个富翁损失很少的福利，却能够极大地增加乞丐的福利，使其免于死亡，那么社会的福利总和就增加了，所以从功利主义的角度看，这样的财富转移是一种改善，而最初的极端不平等状态则是不理想的，因为它的福利总和较低。

可以看到，帕雷托改进要求在提高某些人福利的时候不能减少任何一个人的福利，而功利主义则允许为了提高福利总和而减少一些人的福利。

# 2. 机制在广告中的应用
## 2.1 广告投放中的囚徒困境

![avatar](/images/计算广告/ad-3.png)

公司A和公司B是淘宝网的两个品牌卖家，互相竞争市场。

 * 假设A和B的品牌效果和质量近似，比如耐克和阿迪。<br>
 * 假设对A和B品牌需要的用户人群是一定的，比如品牌运动鞋的淘宝买家。<br>
 
那么

 * A和B均未进行广告营销时，当淘宝用户搜索、浏览时，会根据用户的兴趣和相关性被推荐A或B，A和B可以拿到的近似相同的流量，获得的收益均为35；<br>
 * 此时，若A或B其中一方，开始投放广告，获取了更多的流量，收益从35->50，而对手由于未进行广告营销，流量减少，从35->5;<br>
 * 最终结果A和B的博弈，均会选择投放广告，并会不断地增加广告开发、设法提升广告的质量，尽管最终两个公司的收益均会因为广告成本，而降低至25。<br>
若二公司不信任对方，无法合作，背叛成为支配性策略时，二公司将陷入广告战，而广告成本的增加损害了二公司的收益，这就是陷入囚徒困境。在现实中，要二互相竞争的公司达成合作协议是较为困难的，多数都会陷入囚徒困境中。

## 2.2 广告系统中的多方博弈

![avatar](/images/计算广告/ad-4.png)

互联网广告平台也是一个多方面利益博弈的领域，主要参与者有广告主、媒体、互联网用户、广告系统。<br>
 * 广告主追求的是触达媒体的目标用户，例如淘宝的商家通过投放广告触达在淘宝里的目标用户；<br>
 * 互联网用户追求媒体的内容和社区，例如淘宝的买家通过逛淘宝获取心仪的商品、内容；<br>
 * 媒体追求广告系统变现能力的最大化，淘宝通过广告系统追求变现；<br>
 * 在这种相互博弈的状态下，广告系统成为资源调整的的核心作用，它是整个循环的宏观调控中心。

而广告系统的这个调控能力，主要通过计费模式和计费方式实现。<br>
计费模式：

 * CPT（Cost Per Time）：按展示时间计费<br>
 * CPM（Cost Per Mille）：按千次展现计费<br>
   * 包含oCPM (Optimized Cost Per Mille)：以目标转化为优化方式，按展现计费<br>
 * CPC（Cost Per Click）：按点击计费<br>
   * 包含oCPC (Optimized Cost Per Click)：以目标转化为优化方式，按点击计费<br>
 * CPS（Cost Per Sales）/ CPA（Cost Per Action）：按转化计费

计费方式：

 * GFP（Generalize First Price）：广义第一价格<br>
 * GSP（Generalize Second Price）：广义第二价格<br>
 * VCG （Vickrey-Clarke-Groves）：名字来源于三个大牛的名字，VCG计费机制
 
广告系统的目标是帮助广告主、用户、媒体实现帕累托最优（Pareto Optimality），从而实现广告系统的长期、稳定地发展。

## 2.3 基本的拍卖机制

![avatar](/images/计算广告/ad-5.png)

明拍：
  * 英式拍卖：卖方先定一个极低的价格，然后逐渐提高这个价格，在提高的过程中，那些认为价格已经超出自己估价的竞标者不断退出，最后剩下的就是中标者，他支付当时的价格水平。<br>
  * 荷兰式拍卖：卖方先定一个很高价格，然后逐步地降低这个价格，在降低的过程中，第一个应价的人即是中标人，其支付的是他所应承的价格。<br>

暗拍：

  * 密封第一价格拍卖：每个竞标者都告诉卖方一个价格，但这个价格除了其本人及卖方，其他的竞标者都不知道，最后出价最高的竞标者中标，并支付他所承诺的价格。<br>
  * 密封第二价格拍卖：每个竞标者都告诉卖方一个价格，但这个价格除了其本人及卖方，其他的竞标者都不知道，最后是出价最高的竞标者中标，所不同的是，他所支付的价格是所有价格当中第二高的价格。
  
## 2.4 互联网广告的计费机制

### 2.4.1 GFP 广义第一价格
在2002年之前，所有搜索引擎的广告都是按GFP计费的。

  * 计费规则：出价最高者得到广告位，支付自己的出价。<br>
  * 缺点：<br>
    * 平台收益会非常不稳定，竞价效率不高。背后的根源在于这种拍卖方式，从博弈论的角度不存在纳什均衡点，即它永远存在一个你追我赶的状态。<br>
    * 在重复博弈的机制上，不符合帕累托最优。一个好的拍卖机制是把标的物卖给对它估值最高的竞价者，而在下面讲的例子中，估值最高的是A，然而由于“微小差值”的调价竞争，他有很大一部分流量被估值更低的B抢走了。
    
举个例子：

A、B、C三个广告主竞争2个广告位，其每次点击的估值分布为10、4、2。

  * 如果初始A、B、C均讲真话，分别出价10、4、2，A和B竞争到广告位；<br>
  * 此时B会调低价格进行试探，若B调低到1.9元，广告位会被C抢走，此时B试探调整价格为2.01，超过C的估值，C放弃竞争，A同样的通过调低价格，出价为2.02元，B继续试探，调升价格至2.03元，拿到第一个广告位。<br>
  * A和B均采取“微小差值策略”不断的调价，直至一方放弃（B放弃），失去竞争者后A会再次把价格调低。<br>
  * 同时，若平台的大广告主（出价最高的A）突然停止广告投放，平台的收入会产生较大波动。
  
    ![avatar](/images/计算广告/ad-6.png)

### 2.4.2 GSP  广义第二价格
2002年，在Google开展Adwords业务的时候，采用了GSP机制；随后，众多互联网公司纷纷效仿，使得GSP成为了广告位拍卖的主流机制。

  * 计费规则：支付出价第二高者的报价，加上一个系统计价的最小单位值。<br>
  * 优点：在单广告位拍卖上是最优的，是鼓励广告主“讲真话”的机制。<br>
  * 缺点：在多广告位拍卖上，不是一种“鼓励讲真话”的机制，说真话不一定形成纳什均衡，竞价结果不一定全局最优。<br>
  * 典型应用案例：谷歌、微软Bing、百度凤巢搜索广告、阿里妈妈

### 2.4.3 VCG
VCG是密封的多物品拍卖机制，讲真话是占优策略。<br>
  * 基本原理是计算竞价者赢得广告位后，给整个竞价收入带来的收益损失，理论上这个损失就是竞价获胜者应该支付的费用。<br>
  * 计费规则：广告展现后对社会效用造成的损失。广告计费 = 广告不参与展现的其他广告的系统收益和 - 广告参与展现的其他广告的系统收益和
  
  $$ price_i = \frac{\sum_{j=i}^N pCtrq_{(j+1)j} * bid_{j+1} - \sum_{j=i}^{N-1} pCtrq_{(j+1)(j+1)} * bid_{j+1}}{pCtrq_{jj}}$$
  
  * 典型应用案例：Facebook、百度信息流广告
  
我们来通过一个具体例子来例假GSP、VCG计费的不同：

有两个广告位，三个广告主参与竞价，假设“点击率只与广告位置”有关，为了方便计算，假设第一个广告位点击率u1=1.0,  第二个广告位点击率 u2=0.4

如果用GSP计费：

  ![avatar](/images/计算广告/ad-7.png)

  * 左边蓝色区域（第一次出价）：<br>
    * 对于广告主A，其预估点击价值为7元，如果讲真话，按7元出价，按GSP计费方式计费为第二者的报价6元，其收益utility为（7 - 6）* 1.0 = 1 元；<br>
    * 对于广告主B，按真实估值，出价6元，拿到第二个广告位，计费为C的报价1元，其utility为（6-1）*0.4 = 2元<br>
  * 右边橙色区域（调价）：<br>
    * 若广告主A，讲假话，调低价格，从7元调至5元，此时低于广告主B的出价6元，只能拿到第二个广告位，此时计费为按下一个广告主C的价格1元，其收益utility为（7 - 1）* 0.4 = 2.4 元<br>
    * 广告主A通过讲假话，降低出价，获得了更高的收益（+1.4元），讲真话不是占优策略。

如果用VCG计费：

  ![avatar](/images/计算广告/ad-8.png)

  * 左边蓝色区域（第一次出价）<br>
    * 对于广告主A，其预估点击价值为7元，如果讲真话，按7元出价，按VCG计费，为其展现后对系统收益造成的损失，((6 * 1.0  + 1 * 0.4) - (6 * 0.4)) / 1.0 = (6.4 - 2.4) / 1.0 = 4，其收益utility为 7 - 4  = 3元；<br>
    * 对于广告主B，按真实估值出价6元，计费（(7*1.0 + 1*0.4) - (7*1.0)) / 0.4 = (7.4 - 7) / 0.4 = 1元，其收益utility为（6 - 1) * 0.4 = 2元<br>
  * 右边橙色区域（调价）<br>
    * 若广告主A讲假话，调低价格，从7元调至5元，拿到第二个广告位，此时其应付 （(6 * 1.0 + 1 * 0.4) - (6 * 1.0)) / 0.4 = (6.4 - 6) / 0.4 = 1，其收益utility为（7 - 1）* 0.4 = 2.4元<br>
    * 广告主A调价后，广告主B拿到第一个广告位，计费((5*1.0 + 1*0.4) - (5*0.4)) / 1.0 = 5.4 - 2 = 3.4 元，其收益utility为 6 - 3.4 = 2.6元<br>
    * 广告主A讲假话，降低出价，其收益受损（-0.6元），因此对于VCG计费来说，讲真话是占优策略

从刚才的例子中可以总结：

  * VCG计费机制，广告主讲真话是占优策略；GSP计费机制，广告主讲真话不是占优策略，可以通过调价获取更多收益。<br>
  * VCG计费收取广告主的费用，小于等于GSP。<br>
    * 当广告i  <  广告位N时，VCG计费小于GSP，即上面例子中第1个广告在第2个广告位；<br>
    * 当广告i  =  广告位N时，VCG计费等于GSP，即上面例子中第1个广告在第2个广告位。
    
因此，总结下来，GSP和VCG各有优劣，对比如下：

  |  | GSP | VCG |
  | :----- | :---- | :---- |
  | 优势 |  1. 平台的短期收入高于VCG；<br>  2. 计算逻辑简单；<br>  3. 广告主容易理解 |  1. 激励相容；<br>  2. 鼓励广告主说真话，广告主的出价能够反映流量的真实价值 |
  | 劣势 |  1. 广告主出价不一定反映流量真实价值，调低价格可获益；<br>  2. 平台收入波动大 |  1. 二平台短期收入的损失；<br>  2. 计算逻辑复杂；<br>  3. 广告主不容易理解、教育成本高|


### 2.4.4 VCG实践
讲了很多的机制设计的理论，那么究竟VCG实战中的效果是怎么样的呢？

VCG虽然从理论上是激励兼容的机制，但是由于计算逻辑复杂，短期收益比GSP低，且不易向广告主解释，因此实际上目前使用VCG进行广告计费公司并不多。

据笔者所知，目前业内Facebook和百度信息流的广告是使用VCG且取得不错的效果的。以百度信息流广告为例，介绍一下VCG上线后的效果数据（具体的敏感指标数据已隐去，只保留相对效果值）

ABTest 评估的方式：随机圈广告主ID长期实验

**实验效果：**<br>
  * 广告收入： VCG上线后短期内收入下降，长期收入恢复
  
  ![avatar](/images/计算广告/ad-9.png)
  
  * 广告主调价：VCG相比于GSP调价的比例减少，竞价环境更加稳定
  
  ![avatar](/images/计算广告/ad-10.png)
  
  * 广告主的留存：VCG相比于GSP，长期留存的广告主数目增加，VCG计费的广告主账户下创建的推广计划数也有明显的提升
  
  ![avatar](/images/计算广告/ad-11.png)


# 3. 推荐学习资料
  * 计算广告学：
    * 刘鹏，《计算广告：互联网商业变现的市场与技术》
    * 网易云课堂，刘鹏的计算广告学的视频教程
  * 经济学和博弈论：
    * 曼昆，《经济学原理》
    * 朱·弗登博格，《博弈论》
    * 汤姆·齐格弗里德，《纳什均衡与博弈论》
