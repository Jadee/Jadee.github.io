---
title: OCPC_1_基于OCPC的自动挡出价方案
date: 2019-11-10
categories: 计算广告
tags:
- 计算广告
- 机制设计
---

# 背景

搜索广告市场由广告平台，搜索用户，广告主三方构成。广告平台通过机制的设计，优化搜索用户体验和广告主投放效果，获得长期的收入。广告主为了达成某种营销诉求，在广告市场中参与竞价获取目标流量。搜索广告通常是以cpc计费的实时竞价系统，市场瞬息万变，平台会提供一些工具帮助广告主获得更好的竞价效率和效果。

<!-- more -->

# 出价工具思考

搜索广告相对于其它广告形式最主要的区别是广告主通过搜索词标的流量的价值，并通过对词设置cpc参与流量的竞争。这种广告形式相对于传统广告，展示广告，流量精准，使得搜索广告受到大量广告主的青睐。在直通车平台上，活跃着超过百万的广告主，不同类目推广需求多样，大小客户推广能力不同。为了服务好这些广告主，我们对他们的竞价行为深入分析，发现了两类问题，并提供了解决方案。

* 问题1. 搜索词零散导致广告主竞价的维度过高，难以维护。  
&emsp;&emsp;解决方案，我们提供了一系列的方案减少广告主竞价的维度，如长尾词打包，智能买词，量化流量价值（质量分）等等措施。

* 问题2. 搜索用户个性化的需求导致以词为粒度的cpc出价过于粗放，加上我们提供了减少竞价维度的方案，导致该问题更加严重。  
&emsp;&emsp;解决方案，我们通过引入能够标识搜索人群属性的标签，使得广告主可以在原有搜索词cpc的基础上对人群溢价，也就是说流量的标的物变成了<词，人群>。

说到这里，我们其实会发现问题1和问题2存在一种分分合合的矛盾。

* 一方面，我们希望减少广告主因为学习直通车技巧而损失的机会成本，把更多的精力放在宝贝优化，营销策划上，所以我们减少竞价的维度。

* 另一方面，广告主需要优化效果，有精细化出价的需求，这个带来好处是少量有专业车手的大广告主通过经验和技巧优化好了效果，而那些广大的中小广告主因为竞价维度的爆炸式增长难以维护。

为了规避陷入这种矛盾当中，技术上，通过提供Ocpc的出价方案，系统自动按照每个流量的转化价值动态出价，广告主不需要关注细分流量上的出价；产品上，引导广告主直面 推广的诉求 ，即，推广什么宝贝，以多少成本拿什么流量，把竞价的标的物从词，<词，人群>简化为宝贝。

可以理解以前的出价方式是手动挡，需要广告主关注所有的细节，而直通车需要一个自动挡的方案。在设计自动挡方案之前，我们先了解清楚广告主的推广诉求，才能对症下药设计出具体的产品和技术方案。

# 推广诉求建模

广告主在直通车推广的诉求简单来讲就是选宝贝，花钱，买流量。宝贝是直通车推广的一个实体，广告主根据自己的需求选择宝贝，每个宝贝的推广诉求多样，测款，引流，平销，清仓等等。这些不同诉求之间的区别，体现在受众选择和成本控制的区别，举几个例子，

| 诉求	| 受众选择 | 成本控制 | 
|测款	| 快速获得展现，验证消费者对产品认可程度，<br>比较不同宝贝点击和成交的差异	| 可以忍受较低的直通车roi | 
|引流	| 持续拉动流量进店，间接带动自然搜索的流量	| 直通车roi可以亏损，关注对全店roi的促进作用 | 
|平销	| 持续拉动流量进店，正常销售	| 关注直通车推广的长期收益，无法忍受直通车roi亏损 | 

可以看出，对于一个推广诉求，长期有一个成本的度量TargetRoi，在能够满足该成本约束的情况下，获取最大的流量。

$$ \max Gmv $$

$$ s.t. RealRoi >= TargetRoi $$

这样对诉求建模，我们面临的问题就清晰了，

1. 如何达成某个成本的目标TargetRoi(或者说TakeRate = 1/TargetRoi)，也就是我们的Ocpc实现方案。  
2. 诉求多种多样，如何获得不同诉求背后的TargetRoi。  
3. 选择受众，覆盖最大的满足成本约束的流量。（受众选择，本文不涉及）。

这样我们形成了解决不同类型诉求的思路，转化出价这个产品就是我们依据这套思路实例化的解决方案。下文会详细介绍具体的产品技术方案。

# 求解方案

## Ocpc

假设广告主推广诉求的成本约束TargetRoi已知，系统在cpc扣费的机制下，如何帮助广告主优化转化目标？这里我们对单个流量的Roi进行展开, 

$$ Roi = Gmv/Cost = (ctr * cvr * ItemPrice)/ (ctr * bid) $$

$$ bid = cvr * ItemPrice / Roi = cvr * ItemPrice * TakeRate $$

从该公式可以看出，如果每个流量都按照TargetRoi出价，每个流量都能达成期望TargetRoi的目标，也就达成整体成本约束TargetRoi。按这种方式出价，高转化的流量出高价，低转化的流量出低价，相比较直接的cpc出价更逼近流量真实的价值。在直通车GSP扣费机制下，广告主不需要知道竞争对手的出价策略，对自己最有利的出价方式就是按照流量的价值出价，而这个价值的衡量方式就是TargetRoi。

## TargetRoi

在cpc广告中，广告主没有直接表达TargetRoi，Roi本身对于一个宝贝而言也不稳定，有可能广告主也不清楚短期内推广的Roi是什么，这就为我们达成广告主诉求造成了很大的障碍。有这样一些思路，

* 行业历史Roi, 或者店铺历史Roi，这些笼统的估计，都很难解决广告主推广中多样的诉求。  
* 广告主指定Roi, 系统帮助达成，这样做和cps广告并没有差异, 平台收益的风险太大。  
* 广告主表达成本的指标为cpc, 而优化的指标为roi 。那这两种表达投放成本的方式，有什么关联。我们是否可以根据广告主表达的cpc，推导出广告主的TargetRoi。

广告主选定宝贝买词之后，候选流量大致已经确定，也就是说流量cvr已经确定，而每个流量也设定了cpc，利用线上实时记录的完整的竞价replay日志（记录每个候选流量的cpc, pctr, pcvr），不考虑展现概率pvr的情况下，TargetRoi可以推导得出。

$$ \sum_{k=1}^n pctr_k * cpc_k = TakeRate * pGmv =  TakeRate * \sum_ {k=1}^n  pctr_k * pcvr_k * ItemPrice $$

$$ TargetRoi = 1/TakeRate =  \sum_ {k=1}^n   pctr_k * pcvr_k * ItemPrice / \sum_{k=1}^n pctr_k * cpc_k $$

cpc是客户控制成本的抓手，只要改变cpc，TargetRoi也会变化，利用线上实时更新机制，我们可以实现小时级更新TargetRoi的变化。这样建立的cpc和TargetRoi的绑定关系符合广告主的基本认知，可以依此来设计产品和算法的逻辑。

$$ \triangle TakeRate =  \sum_{k=1}^n pctr_k * \triangle cpc / \sum_ {k=1}^n pctr_k * pcvr_k * ItemPrice $$

## 产品算法逻辑

设计一个出价工具，除了提升竞价的效率(宝贝粒度出价)，更需要通过效果的提升激励客户使用。为此我们设计的产品逻辑是，广告主开启功能后，维持宝贝消耗与cpc消耗一致，提升Roi。通过离线模拟，估算维持消耗不变的a * TakeRate；线上微调所有宝贝的TakeRate, 维持整体消耗一致。

$$\sum_{k=1}^n pvr_k * pctr_k * cpc_k = \sum_{k=1}^n pvr_k *pctr_k * ocpc_k $$

$$ = \sum_ {k=1}^n  pvr_k * pctr_k * max(MinCpc_k, min(MaxCpc_k, pcvr_k * ItemPrice * a *TakeRate) ) $$

这样的物理意义是说，cpc切换Ocpc后，通过 a * TakeRate 去竞价，维持期望消耗一致。由于Ocpc按照流量转化价值出价，高pcvr的流量获得更多的展现机会，低pcvr的流量失去展现机会，所以花同样的钱，由于展现的平均pcvr较高，消耗不变的情况下，roi更高，TakeRate 较低。图中为开启功能后，点击日志中，pcvr的分布，可以看出低pcvr的点击占比明显下降，高pcvr的点击占比显著提升。

## 产品设计

除了提升效果，简化客户的竞价维度也是产品设计的一个重要目标，因此该功能做在宝贝粒度。广告主根据不同的诉求来调整成本的预期，我们开放了宝贝粒度整体溢价的接口和三种出价偏好，相当于汽车的油门和变速箱，灵活控制花钱速度和投放成本。

溢价接口：控制宝贝所有候选流量的溢价上限，调控宝贝粒度的点击成本，另外，溢价的变化也会实时转化成TargetRoi(TakeRate)的变化。

出价偏好：在同一个Cpc下，广告主可以选择多种档位的出价策略，偏向于优化投产，还是偏向于流量，均可以通过参数a来控制。

# 整体思考

作为平台DSP，跟外部DSP共同点是均从服务广告主的角度来思考问题，但是解决问题的思路有所不同，外部DSP并非服务所有广告主，他们可以攫取其它广告主的利益来为自己的客户服务。而平台DSP面向所有广告主，需要提供的是一种普惠的出价能力，引导整个广告市场公平高效的竞争。

广告主利用该出价工具，只需要设置出价的范围，系统在范围内帮助广告主按照流量价值出价，扣费依然使用GSP的扣费机制。竞价的标的物由某个词，或者词和人群的组合，简化为一个宝贝，广告主不需要频繁地试探出价，依然保留了GSP机制下，竞价系统的稳定性。

从平台排序的角度来看，大量广告主使用该竞价方式后，候选宝贝，经过相关性过滤后，按照ecpm最大化排序

$$ \begin{align} pctr * bid & = pctr * pcvr * ItemPrice * TakeRate \\
& = pGmv * TakeRate = pCost 
\end{align}$$

$ctr * cvr * ItemPrice$ 反映了每个流量的 $pGMV$，$TakeRate$ 反映了每个广告主的成本承受能力，通过引入该出价机制，搜索用户的体验 $pGMV$，广告主的成本约束 $TakeRate$ 与平台的收益 $pCost$ 三者的目标得到了统一。

# 效果

目前该功能对积累了一定点击的宝贝开放，我们选择大量与大盘同分布测试广告主，其中能够开启转化出价的宝贝占所有测试广告主总消耗的大部分。我们为这批广告主开通功能后，广告主经过前期的测试对比，逐渐开启。

该功能帮助广告主优化转化，如下图所示开启后相比较cpc出价转化效果显著提升，横轴为时间，纵轴为Roi（30号开始，广告主逐步开启 ）

