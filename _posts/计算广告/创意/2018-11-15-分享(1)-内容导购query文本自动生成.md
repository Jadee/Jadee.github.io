---
title: 分享(1)-内容导购query文本自动生成
date: 2018-11-15
categories: 计算广告
tags:
- 计算广告
- 智能创意
---

# 背景

对于一些导购网站，往往会收录大量的优质内容，对于这类优质内容，往往会提到一些相关商品，比如 某一类口红、面霜等。这些商品都在淘宝等购物app中会存在。所以从用户的角度，希望可以看完文章之后，可以直接有入口找到相关搜索商品。

内容导购query 文本自动生成 就是为了解决这个问题。 从一篇文章中，自动生成出用户搜索的商品query，进行推送。

# 技术方案

在淘宝经验的内容频道中，以[链接](https://market.m.taobao.com/apps/market/content/index.html?spm=ata.13261165.0.0.42c775e9V5zURl&contentId=200526506660)为例，一篇文章往往会提到多个商品。

已经有一些标签抽取的技术，可以从文章中抽取关键词来描述文章，比如[例子](https://market.m.taobao.com/apps/market/content/index.html?spm=ata.13261165.0.0.42c775e9V5zURl&contentId=201289334777&source=weitao_2017_cover)
```
**收缩毛孔**  **去角质** **磨砂膏** **身体乳** **身体护理**  **进口咖啡**
```

但是这类标签抽取会遇到抽取不完整，如果内容提到的商品过多，超过10个，召回率就会下降。

利用文本自动生成来抽取导购query，可以有效地避免这类标签抽取不完整的问题，同时后期也有继续提高的空间。

# 实现细节

导购文章一般有固定的格式和框架，主要为罗列型、对比型、说明型等。

观察这些不同类型，可以发现在句子层面，文章会把对商品进行精确的描述。所以在文本生成query实现中，采用了句子的维度而不是文章的维度来做生成的输入。

## 一、文章数据预处理

1. 先把文章按照 句子维度 进行拆分，根据中文断句标点进行拆分。

2. 对于拆分过的句子，并不是所有的句子都是商品描述句，有部分句子仅仅是类似于“今天在香港逛街”等描述性的句子，通过NER抽取的方式，对句子进行分词以及打标，只过滤出那些含有品牌品类的的句子，如“国货扛把子玛丽黛佳的自然生动眉笔，显色度高。”

# 二、模型训练数据

1. 文本生成需要大量 <输入-输出> 语料对，如翻译模型需要 两种语言之间的翻译对。在内容导购query生成的这个问题中，传统思路是根据 步骤一的句子进行标注，人工打标出一批训练数据，但这样一方面比较费时费力，另外一方面这类主观标注的数据一致性也是问题，同一句话人工打标的结果也不一定一致。 在这里，采取了另外一种获取语料对的方式。

2. 通过生成语料对，淘宝搜索场景中有大量的用户搜索日志，用户搜索query，然后点击某个商品，就类似于标注了一次之间的关系。将这类数据进行清洗，同时反向匹配，可以得到大量 <商品描述-query>的语料对。

![avatar]()

3. 将步骤2中得到的语料对根据类目进行分类，美妆、3C、服饰等不同类目下的商品描述和query都不一致，虽然理论上都可以通过模型训练出来，但是训练数据和资源成本较高，利用先验知识类目进行区分之后，可以得到针对某个特定类目的模型。

4. 利用经典的seq2seq模型进行训练，Seq2Seq模型(Encoder-Decoder模型)，简化来讲，其本质是将一段不定长的序列数据 向量化到一个定长的Vector（encoder的输出），

![avatar]()

训练的代码参考了<https://github.com/google/seq2seq>，[代码说明](https://google.github.io/seq2seq/?spm=ata.13261165.0.0.42c775e9V5zURl)

由于输入和输出 分别是商品描述和用户query，都是短文本为主，所以在embedding层使用了char-embedding,而不是使用word-embedding。

5. 注意事项，char-embedding可以有一些优化，比如型号词，非中文描述词，可以合并成一个"word" 来进行embedding, 通过先验知识来降低训练难度。

# 实验与应用

![avatar]()

以“ysl圣罗兰限量款甲油” 为例，NER结果只能抽取到ysl甲油，但 生成模型可以生成“ysl指甲油” 结果，因为在大量的搜索日志-商品标题的关系中，已经学到了“ysl”与“指甲油”的关系。

模型的训练数据是根据 <商品描述-query>的语料对，待预测的数据是淘宝内容导购文章，经过分句处理之后。训练数据的关系，会造成最后生成的query带有明显的搜索用语，比如“安耐晒防晒霜女”。

同时 为了预防文本生成不可控的query，对生成内容做了后验过滤，通过对NER抽取结果和文本生成结果做的比较，过滤出那些包含品牌品类的生成query。

